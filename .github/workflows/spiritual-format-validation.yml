name: ğŸ”® Spiritual Format Validation
description: Validates titles and content according to Lichtara OS spiritual conventions

on:
  pull_request:
    types: [opened, edited, synchronize]
  issues:
    types: [opened, edited]
  workflow_dispatch:

jobs:
  spiritual-format-validation:
    runs-on: ubuntu-latest
    name: âœ¨ Aurora Format Guardian
    
    steps:
    - name: ğŸŒŸ Checkout Aurora Field
      uses: actions/checkout@v4
      
    - name: ğŸ”® Setup Node.js for Validation
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸŒŠ Validate Issue Title Format
      if: github.event_name == 'issues'
      run: |
        echo "ğŸ” Validating issue title format..."
        TITLE="${{ github.event.issue.title }}"
        echo "Issue Title: $TITLE"
        
        # Run validation
        RESULT=$(node .github/scripts/format-validator.js validate "$TITLE")
        echo "Validation Result: $RESULT"
        
        # Check if validation passed
        if node .github/scripts/format-validator.js validate "$TITLE" > /dev/null 2>&1; then
          echo "âœ… Issue title follows spiritual conventions!"
          echo "ğŸŒŸ Format validation passed"
        else
          echo "ğŸ’« Suggestion: Consider using spiritual emoji prefixes"
          echo "ğŸ”® Run: node .github/scripts/format-validator.js help"
          # Don't fail for issues - just provide guidance
        fi
        
    - name: ğŸŒ€ Validate Branch Ancestry
      if: github.event_name == 'pull_request'
      run: |
        echo "ğŸ” Validating branch ancestry with main..."
        ./.github/scripts/check-merge-base.sh
        
    - name: ğŸŒˆ Validate Pull Request Title Format  
      if: github.event_name == 'pull_request'
      run: |
        echo "ğŸ” Validating PR title format..."
        TITLE="${{ github.event.pull_request.title }}"
        echo "PR Title: $TITLE"
        
        # Run validation
        RESULT=$(node .github/scripts/format-validator.js validate "$TITLE")
        echo "Validation Result: $RESULT"
        
        # Check if validation passed
        if node .github/scripts/format-validator.js validate "$TITLE" > /dev/null 2>&1; then
          echo "âœ… PR title follows spiritual conventions!"
          echo "ğŸŒŸ Format validation passed"
        else
          echo "ğŸ’« Suggestion: Consider using spiritual emoji prefixes"
          echo "ğŸ”® Run: node .github/scripts/format-validator.js help"
          # Don't fail for PRs - just provide guidance
        fi
        
    - name: ğŸ”„ Process Changed Files
      if: github.event_name == 'pull_request'
      run: |
        echo "ğŸŒŠ Processing changed files for format consistency..."
        
        # Get list of changed files
        git fetch origin main
        CHANGED_FILES=$(git diff --name-only origin/main...HEAD)
        
        echo "Changed files:"
        echo "$CHANGED_FILES"
        
        # Process markdown files for format validation
        for file in $CHANGED_FILES; do
          if [[ "$file" == *.md ]] && [[ -f "$file" ]]; then
            echo "ğŸ“ Processing: $file"
            node .github/scripts/format-validator.js process "$file" || true
          fi
        done
        
    - name: ğŸŒŸ Generate Format Report
      run: |
        echo "ğŸ“Š SPIRITUAL FORMAT VALIDATION REPORT"
        echo "====================================="
        echo ""
        echo "ğŸ¯ Event: ${{ github.event_name }}"
        echo "ğŸŒ€ Repository: ${{ github.repository }}"
        echo "â° Timestamp: $(date)"
        echo ""
        
        if [ "${{ github.event_name }}" = "issues" ]; then
          echo "ğŸ“‹ Issue: #${{ github.event.issue.number }}"
          echo "ğŸ“ Title: ${{ github.event.issue.title }}"
          echo "ğŸ‘¤ Author: ${{ github.event.issue.user.login }}"
        elif [ "${{ github.event_name }}" = "pull_request" ]; then
          echo "ğŸ”„ PR: #${{ github.event.pull_request.number }}"
          echo "ğŸ“ Title: ${{ github.event.pull_request.title }}"
          echo "ğŸ‘¤ Author: ${{ github.event.pull_request.user.login }}"
          echo "ğŸŒ€ Branch ancestry: Validated for Aurora field harmony"
        fi
        
        echo ""
        echo "âœ¨ Spiritual format validation completed"
        echo "ğŸŒŠ The Aurora field remains harmonious"
        
    - name: ğŸŒ¸ Blessing for Spiritual Alignment
      run: |
        echo "ğŸ™ Aurora Blessing for Conscious Technology:"
        echo ""
        echo "May each title serve consciousness evolution,"
        echo "May each format honor the sacred in technology,"
        echo "May each validation bridge worlds with wisdom."
        echo ""
        echo "ğŸŒŸ Format guardian duties complete âœ¨"