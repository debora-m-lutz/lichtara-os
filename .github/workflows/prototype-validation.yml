name: ğŸŒŸ Prototype Validation
description: Validate and test prototype applications

on:
  pull_request:
    paths:
      - '05-prototipos/**'
  push:
    branches: [main]
    paths:
      - '05-prototipos/**'
  workflow_dispatch:

jobs:
  validate-prototypes:
    runs-on: ubuntu-latest
    name: ğŸ”® Prototype Aurora Guardian
    
    strategy:
      matrix:
        prototype: ['05_Prototipo', '5.1_Prototipo']
    
    steps:
    - name: ğŸŒŸ Checkout Aurora Field
      uses: actions/checkout@v4
      
    - name: ğŸ”® Setup Node.js for Validation
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        always-auth: false
        check-latest: false
        
    - name: ğŸ¯ Cache npm dependencies
      uses: actions/cache@v4
      with:
        path: ~/.npm
        key: ${{ runner.os }}-node-${{ matrix.prototype }}-${{ hashFiles('05-prototipos/05-prototipo/${{ matrix.prototype }}/package*.json') }}
        restore-keys: |
          ${{ runner.os }}-node-${{ matrix.prototype }}-
          ${{ runner.os }}-node-
        
    - name: ğŸ“¦ Install Dependencies for ${{ matrix.prototype }}
      timeout-minutes: 10
      run: |
        cd 05-prototipos/05-prototipo/${{ matrix.prototype }}
        if [ -f package.json ]; then
          echo "ğŸŒŠ Installing dependencies for ${{ matrix.prototype }}..."
          
          # Configure npm for better CI performance
          npm config set audit false
          npm config set progress false
          npm config set fund false
          
          # Generate package-lock.json if it doesn't exist (for faster installs)
          if [ ! -f package-lock.json ]; then
            echo "ğŸ”§ Generating package-lock.json for caching..."
            npm install --package-lock-only --no-optional
          fi
          
          # Use npm ci if package-lock.json exists, otherwise npm install
          if [ -f package-lock.json ]; then
            echo "ğŸš€ Using npm ci for fast, reliable install..."
            npm ci --no-optional
          else
            echo "âš¡ Using npm install..."
            npm install --no-optional
          fi
          
          echo "âœ… Dependencies installed successfully for ${{ matrix.prototype }}"
        else
          echo "âš ï¸ No package.json found for ${{ matrix.prototype }}"
        fi
        
    - name: ğŸ” TypeScript Check for ${{ matrix.prototype }}
      timeout-minutes: 5
      run: |
        cd 05-prototipos/05-prototipo/${{ matrix.prototype }}
        if [ -f package.json ]; then
          echo "ğŸŒŠ Running TypeScript check for ${{ matrix.prototype }}..."
          if npm run check 2>/dev/null; then
            echo "âœ… TypeScript validation passed for ${{ matrix.prototype }}"
          else
            echo "ğŸ’« TypeScript check failed for ${{ matrix.prototype }} (expected for prototypes in development)"
          fi
        else
          echo "ğŸ’« No package.json found for ${{ matrix.prototype }}"
        fi
        
    - name: ğŸ—ï¸ Build Check for ${{ matrix.prototype }}
      timeout-minutes: 5
      run: |
        cd 05-prototipos/05-prototipo/${{ matrix.prototype }}
        if [ -f package.json ]; then
          echo "ğŸŒŠ Running build check for ${{ matrix.prototype }}..."
          if npm run build 2>/dev/null; then
            echo "âœ… Build validation passed for ${{ matrix.prototype }}"
          else
            echo "ğŸ’« Build check failed for ${{ matrix.prototype }} (expected for prototypes in development)"
          fi
        else
          echo "ğŸ’« No package.json found for ${{ matrix.prototype }}"
        fi
        
    - name: ğŸŒŸ Prototype Status Report
      run: |
        echo "ğŸ“Š PROTOTYPE VALIDATION REPORT"
        echo "=============================="
        echo ""
        echo "ğŸ¯ Prototype: ${{ matrix.prototype }}"
        echo "ğŸŒ€ Repository: ${{ github.repository }}"
        echo "â° Timestamp: $(date)"
        echo ""
        echo "âœ¨ Prototype validation completed"
        echo "ğŸŒŠ The Aurora prototypes maintain harmony"
        
    - name: ğŸŒ¸ Blessing for Prototype Evolution
      run: |
        echo "ğŸ™ Aurora Blessing for Conscious Prototyping:"
        echo ""
        echo "May each prototype serve consciousness evolution,"
        echo "May each iteration honor the sacred in technology,"
        echo "May each development bridge worlds with wisdom."
        echo ""
        echo "ğŸŒŸ Prototype guardian duties complete âœ¨"