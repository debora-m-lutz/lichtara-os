---
name: Security Scan - Sensitive Files

'on':
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  scan-sensitive-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Scan for potentially sensitive files
        run: |
          echo "üîç Scanning for potentially sensitive files..."

          # Check for common sensitive file patterns
          sensitive_patterns=("*.key" "*.pem" "*.p12" "*.pfx" ".env" \
            "secrets.json")

          found_sensitive=false

          for pattern in "${sensitive_patterns[@]}"; do
            if find . -name "$pattern" -not -path "./.git/*" | grep -q .; then
              echo "‚ö†Ô∏è Found potential sensitive files matching $pattern:"
              find . -name "$pattern" -not -path "./.git/*"
              found_sensitive=true
            fi
          done

          if [ "$found_sensitive" = true ]; then
            echo ""
            echo "‚ùå Security scan failed: Sensitive files detected!"
            echo "Please review the files above and ensure they should be" \
              "committed."
            echo "Consider adding them to .gitignore if they contain" \
              "sensitive data."
            exit 1
          fi

          echo "‚úÖ Sensitive file scan completed - No sensitive files found"
